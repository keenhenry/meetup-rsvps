{"paragraphs":[{"text":"%pyspark\nfrom pyspark.sql.functions import explode\nimport time","user":"anonymous","dateUpdated":"2017-05-11T03:38:22+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1494473368164_1663969338","id":"20170501-035626_627189763","dateCreated":"2017-05-11T03:29:28+0000","dateStarted":"2017-05-11T03:38:22+0000","dateFinished":"2017-05-11T03:38:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9362"},{"text":"%pyspark\nstart = time.time()\nraw_rsvps = spark.read.json(\"s3a://tristan-meetup-data/2017/*/*/*/*\").cache()\nprint (time.time() - start)","user":"anonymous","dateUpdated":"2017-05-11T04:04:32+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"258.848883152\n"}]},"apps":[],"jobName":"paragraph_1494473368167_1664354087","id":"20170501-035639_1180379613","dateCreated":"2017-05-11T03:29:28+0000","dateStarted":"2017-05-11T04:04:32+0000","dateFinished":"2017-05-11T04:08:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9363"},{"text":"%pyspark\nraw_rsvps.printSchema()","user":"anonymous","dateUpdated":"2017-05-11T03:31:53+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- caption: string (nullable = true)\n |-- comment: string (nullable = true)\n |-- ctime: long (nullable = true)\n |-- event: struct (nullable = true)\n |    |-- event_id: string (nullable = true)\n |    |-- event_name: string (nullable = true)\n |    |-- event_url: string (nullable = true)\n |    |-- time: long (nullable = true)\n |-- group: struct (nullable = true)\n |    |-- category: struct (nullable = true)\n |    |    |-- id: long (nullable = true)\n |    |    |-- name: string (nullable = true)\n |    |    |-- shortname: string (nullable = true)\n |    |-- city: string (nullable = true)\n |    |-- country: string (nullable = true)\n |    |-- group_city: string (nullable = true)\n |    |-- group_country: string (nullable = true)\n |    |-- group_id: long (nullable = true)\n |    |-- group_lat: double (nullable = true)\n |    |-- group_lon: double (nullable = true)\n |    |-- group_name: string (nullable = true)\n |    |-- group_photo: struct (nullable = true)\n |    |    |-- highres_link: string (nullable = true)\n |    |    |-- photo_id: long (nullable = true)\n |    |    |-- photo_link: string (nullable = true)\n |    |    |-- thumb_link: string (nullable = true)\n |    |-- group_state: string (nullable = true)\n |    |-- group_topics: array (nullable = true)\n |    |    |-- element: struct (containsNull = true)\n |    |    |    |-- topic_name: string (nullable = true)\n |    |    |    |-- urlkey: string (nullable = true)\n |    |-- group_urlname: string (nullable = true)\n |    |-- id: long (nullable = true)\n |    |-- join_mode: string (nullable = true)\n |    |-- name: string (nullable = true)\n |    |-- state: string (nullable = true)\n |    |-- urlname: string (nullable = true)\n |-- guests: long (nullable = true)\n |-- highres_link: string (nullable = true)\n |-- id: long (nullable = true)\n |-- in_reply_to: long (nullable = true)\n |-- member: struct (nullable = true)\n |    |-- member_id: long (nullable = true)\n |    |-- member_name: string (nullable = true)\n |    |-- name: string (nullable = true)\n |    |-- other_services: struct (nullable = true)\n |    |    |-- facebook: struct (nullable = true)\n |    |    |    |-- identifier: string (nullable = true)\n |    |    |-- flickr: struct (nullable = true)\n |    |    |    |-- identifier: string (nullable = true)\n |    |    |-- linkedin: struct (nullable = true)\n |    |    |    |-- identifier: string (nullable = true)\n |    |    |-- tumblr: struct (nullable = true)\n |    |    |    |-- identifier: string (nullable = true)\n |    |    |-- twitter: struct (nullable = true)\n |    |    |    |-- identifier: string (nullable = true)\n |    |-- photo: string (nullable = true)\n |-- mtime: long (nullable = true)\n |-- photo_album: struct (nullable = true)\n |    |-- event: struct (nullable = true)\n |    |    |-- id: long (nullable = true)\n |    |    |-- name: string (nullable = true)\n |    |-- group: struct (nullable = true)\n |    |    |-- category: struct (nullable = true)\n |    |    |    |-- id: long (nullable = true)\n |    |    |    |-- name: string (nullable = true)\n |    |    |    |-- shortname: string (nullable = true)\n |    |    |-- city: string (nullable = true)\n |    |    |-- country: string (nullable = true)\n |    |    |-- group_lat: double (nullable = true)\n |    |    |-- group_lon: double (nullable = true)\n |    |    |-- group_photo: struct (nullable = true)\n |    |    |    |-- highres_link: string (nullable = true)\n |    |    |    |-- photo_id: long (nullable = true)\n |    |    |    |-- photo_link: string (nullable = true)\n |    |    |    |-- thumb_link: string (nullable = true)\n |    |    |-- group_topics: array (nullable = true)\n |    |    |    |-- element: struct (containsNull = true)\n |    |    |    |    |-- topic_name: string (nullable = true)\n |    |    |    |    |-- urlkey: string (nullable = true)\n |    |    |-- id: long (nullable = true)\n |    |    |-- join_mode: string (nullable = true)\n |    |    |-- name: string (nullable = true)\n |    |    |-- state: string (nullable = true)\n |    |    |-- urlname: string (nullable = true)\n |    |-- photo_album_id: long (nullable = true)\n |-- photo_id: long (nullable = true)\n |-- photo_link: string (nullable = true)\n |-- response: string (nullable = true)\n |-- rsvp_id: long (nullable = true)\n |-- status: string (nullable = true)\n |-- table_name: string (nullable = true)\n |-- thumb_link: string (nullable = true)\n |-- venue: struct (nullable = true)\n |    |-- lat: double (nullable = true)\n |    |-- lon: double (nullable = true)\n |    |-- venue_id: long (nullable = true)\n |    |-- venue_name: string (nullable = true)\n |-- visibility: string (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1494473368168_1662430343","id":"20170501-035721_768140648","dateCreated":"2017-05-11T03:29:28+0000","dateStarted":"2017-05-11T03:31:53+0000","dateFinished":"2017-05-11T03:35:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9364"},{"text":"%pyspark\nrsvps_col = [\n    'rsvp_id',\n    'event.event_id',\n    'group.group_id',\n    'member.member_id',\n    'venue.venue_id',\n    'guests',\n    'mtime',\n    'response',\n    'visibility'\n]\ngroups_col = [\n    'group_id',\n    'group_city',\n    'group_country',\n    'group_lat',\n    'group_lon',\n    'group_name',\n    'group_state',\n    'group_urlname'\n]\nevents_col = [\n    'event_id',\n    'event_name',\n    'event_url',\n    'time'\n]\nmembers_col = [\n    'member_id',\n    'member_name',\n    'photo'\n]\nvenues_col = [\n    'venue_id',\n    'venue_name',\n    'lat',\n    'lon'\n]\ntopics_col = [\n    'urlkey',\n    'topic_name'\n]","user":"anonymous","dateUpdated":"2017-05-11T03:31:54+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1494473368169_1662045594","id":"20170501-035742_212071628","dateCreated":"2017-05-11T03:29:28+0000","dateStarted":"2017-05-11T03:35:36+0000","dateFinished":"2017-05-11T03:35:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9365"},{"text":"%pyspark\ns3_bucket_template = 's3a://tristan-meetup-data/{}/' + time.strftime(\"%Y-%m-%d-%H-%M-%S\")","user":"anonymous","dateUpdated":"2017-05-11T03:38:29+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1494473427965_904367740","id":"20170511-033027_1291547897","dateCreated":"2017-05-11T03:30:27+0000","dateStarted":"2017-05-11T03:38:29+0000","dateFinished":"2017-05-11T03:38:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9366"},{"text":"%pyspark\nrsvps = raw_rsvps.select(rsvps_col).distinct()\nrsvps.write.parquet(s3_bucket_template.format('rsvps'))\n\nmembers = raw_rsvps.select(\"member.*\").distinct()\nmembers.write.parquet(s3_bucket_template.format('members'))\n\nevents = raw_rsvps.select([\"event.\"+col for col in events_col]).distinct()\nevents.write.parquet(s3_bucket_template.format('events'))\n\ntopics = raw_rsvps.select(explode(raw_rsvps.group.group_topics).alias(\"tmp\")).select(\"tmp.*\")\ntopics.write.parquet(s3_bucket_template.format('topics'))\n\nvenues = raw_rsvps.select([\"venue.\"+col for col in venues_col]).distinct()\nvenues.write.parquet(s3_bucket_template.format('venues'))\n\ngroups = raw_rsvps.select([\"group.\"+col for col in groups_col]).distinct()\ngroups.write.parquet(s3_bucket_template.format('groups'))\n\ngroups_topics = raw_rsvps.select(\"group.group_id\", explode(raw_rsvps.group.group_topics.urlkey).alias(\"urlkey\")).distinct()\ngroups_topics.cache() # use for analysis below\ngroups_topics.write.parquet(s3_bucket_template.format('groups_topics'))","user":"anonymous","dateUpdated":"2017-05-11T03:38:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1494473368169_1662045594","id":"20170501-035758_1680736079","dateCreated":"2017-05-11T03:29:28+0000","dateStarted":"2017-05-11T03:38:34+0000","dateFinished":"2017-05-11T04:02:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9367"},{"text":"%pyspark\ncounts = groups_topics.groupby(\"urlkey\").count().orderBy(\"count\", ascending=False)","user":"anonymous","dateUpdated":"2017-05-11T04:03:09+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1494473368174_1661660845","id":"20170501-040212_911753660","dateCreated":"2017-05-11T03:29:28+0000","dateStarted":"2017-05-11T04:03:09+0000","dateFinished":"2017-05-11T04:03:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9368"},{"text":"%pyspark\n# show most popular urlkey\nprint(counts.limit(20).show(20))","user":"anonymous","dateUpdated":"2017-05-11T04:03:53+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-----+\n|              urlkey|count|\n+--------------------+-----+\n|    self-improvement|16337|\n|       socialnetwork|11957|\n|    entrepreneurship|11244|\n|        spirituality|11225|\n|              social|11014|\n|          meditation|10515|\n|professional-netw...|10475|\n|            wellness|10213|\n|           fun-times| 9512|\n|           newintown| 9009|\n|    self-empowerment| 8539|\n|      healthy-living| 8287|\n|            outdoors| 7969|\n|             fitness| 7667|\n|       consciousness| 7369|\n|   business-strategy| 7191|\n|    self-exploration| 7166|\n|         softwaredev| 6722|\n|  startup-businesses| 6669|\n|           excercise| 6636|\n+--------------------+-----+\n\nNone\n"}]},"apps":[],"jobName":"paragraph_1494473368174_1661660845","id":"20170501-040233_677377129","dateCreated":"2017-05-11T03:29:28+0000","dateStarted":"2017-05-11T04:03:53+0000","dateFinished":"2017-05-11T04:04:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:9369"},{"text":"%pyspark\n","dateUpdated":"2017-05-11T03:29:28+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1494473368175_1661276096","id":"20170501-040857_1887966510","dateCreated":"2017-05-11T03:29:28+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:9370"}],"name":"ETL","id":"2CGQN6CQ8","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}